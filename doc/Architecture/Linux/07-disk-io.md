# Disk IO

[IO performance](https://www.cnblogs.com/muahao/p/6596545.html)

[performance](http://www.strolling.cn/2018/07/metric-driven-5-draw-metrics/)

[iowait](https://blog.51cto.com/291268154/1981358)

## 基本概念

### 读写IO(Read/Write)操作

- 写IO
- 读IO

### 单个IO操作
当控制磁盘的控制器接到操作系统的读IO操作指令的时候，控制器就会给磁盘发出一个读数据的指令，并同时将要读取的数据块的地址传递给磁盘，然后磁盘会将读取到的数据传给控制器，并由控制器返回给操作系统，完成一个读IO的操作；同样的，一个写IO的操作也类似，控制器接到写的IO操作的指令和要写入的数据，并将其传递给磁盘，磁盘在数据写入完成之后将操作结果传递回控制器，再由控制器返回给操作系统，完成一个写IO的操作。

### 随机访问与连续访问
随机访问指的是本次IO所给出的扇区地址和上次IO给出扇区地址相差比较大，这样的话磁头在两次IO操作之间需要比较大的移动动作才能重新开始读/写数据。相反的，如果当次IO给出的扇区地址与上次IO结束的扇区地址一致或者是接近的话，那磁头就能很快的开始这次IO操作，这样的多个IO操作称为连续访问。

### 顺序IO模式/并发模式
磁盘控制器可能会一次对磁盘组发出一连串的IO命令，如果磁盘组一次只能执行一个IO命令时称为顺序IO;当磁盘组能同时执行多个IO命令时，称为并发IO。并发IO只能发生在由多个磁盘组成的磁盘组上，单块磁盘只能一次处理一个IO命令。

### 单个IO的大小(IO Chunk Size)

### NVME and PCIe
历史上，大多数SSD使用如SATA、SAS等接口与计算机接口的总线连接。随着固态硬盘在大众市场上的流行，SATA已成为个人电脑中连接SSD的最典型方式；但是，SATA的设计主要是作为机械硬盘驱动器(HDD)的接口，并随着时间的推移越来越难满足速度日益提高的SSD。随着在大众市场的流行，许多固态硬盘的数据速率提升已经放缓。不同于机械硬盘，部分SSD硬盘已经受到SATA最大吞吐量的限制。

在NVMe出现之前，高端的SSD只得采用PCIe总线，但需要使用非标准规范的接口。若只用标准化的SSD接口，操作系统只需要一个驱动程序就能使用匹配规范的所有SSD。这也意味着每个SSD制造商不必使用额外的资源来设计特定接口的驱动程序。

NVMe接口优点

- 性能有数倍的提升
- 可大幅降低延迟
- NVMe可以把最大队列深度从32提升到64000，SSD的IOPS也会得到大幅提升
- 自动功耗切换和动态能耗管理功能大大降低功耗
- NVMe标准的出现解决了不同PCIe SSD之间的驱动适用性问题。